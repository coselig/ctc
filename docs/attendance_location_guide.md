# 打卡系統自動定位功能使用說明

## 🎯 **功能概述**

打卡系統現在支援自動定位功能，可以自動獲取員工打卡時的位置信息，提高考勤管理的準確性。

## 🚀 **新增功能**

### 自動定位
- **GPS 定位**：使用手機 GPS 獲取精確座標
- **地址解析**：將GPS座標轉換為可讀的地址信息
- **一鍵定位**：點擊定位按鈕即可自動填入當前位置
- **權限管理**：安全的位置權限請求和處理

### 用戶界面改進
- **定位按鈕**：地點輸入框旁新增定位按鈕
- **載入指示器**：定位過程中顯示載入動畫
- **狀態提示**：清晰的成功/失敗提示信息

## 🔒 **權限要求**

### Android
- `ACCESS_FINE_LOCATION` - 精確位置權限
- `ACCESS_COARSE_LOCATION` - 大概位置權限

### iOS
- `NSLocationWhenInUseUsageDescription` - 使用時位置權限
- `NSLocationAlwaysUsageDescription` - 持續位置權限

## 📱 **使用方法**

### 步驟 1：開啟位置服務
確保手機的位置服務已開啟：
- **Android**：設定 → 位置 → 開啟
- **iOS**：設定 → 隱私權與安全性 → 定位服務 → 開啟

### 步驟 2：授權應用權限
首次使用時會要求位置權限：
1. 點擊「允許」或「同意」
2. 選擇「使用應用程式期間」權限等級

### 步驟 3：使用自動定位
1. 進入打卡頁面
2. 在地點輸入框旁點擊 📍 定位按鈕
3. 等待定位完成（顯示載入動畫）
4. 系統自動填入當前位置信息

## ⚡ **技術特點**

### 精確定位
- 使用 `LocationAccuracy.high` 高精度定位
- GPS 座標精確到小數點後 6 位
- 自動降級處理（GPS → 網路 → 基站）

### 智能地址解析
- 優先顯示詳細地址（街道、區域、城市）
- 地址解析失敗時顯示GPS座標
- 自動過濾空值，組合有效地址部分

### 錯誤處理
- **位置服務未開啟**：提示開啟位置服務
- **權限被拒絕**：說明如何在設定中開啟
- **定位失敗**：顯示具體錯誤信息
- **網路問題**：降級使用GPS座標

## 📊 **定位數據格式**

### 地址格式
```
街道名, 次區域, 城市, 行政區
例：忠孝東路四段, 大安區, 台北市, 台北市
```

### 座標格式
```
緯度, 經度 (小數點後6位)
例：25.041875, 121.566317
```

## 🔧 **故障排除**

### 常見問題

**Q: 定位按鈕沒有反應**
A: 檢查是否已開啟位置服務和應用權限

**Q: 定位很慢或失敗**
A: 確保在戶外或靠近窗戶，GPS 信號較好的位置

**Q: 顯示座標而非地址**
A: 網路連線問題導致地址解析失敗，座標同樣有效

**Q: 權限被拒絕**
A: 到手機設定 → 應用程式 → CTC → 權限 → 開啟位置權限

### 最佳實踐

1. **戶外使用**：在戶外或窗邊使用以獲得最佳GPS信號
2. **網路連線**：確保網路暢通以進行地址解析
3. **權限設定**：首次使用時務必允許位置權限
4. **手動備份**：也可手動輸入地點作為備用選擇

## 🎯 **未來計劃**

- **地理圍欄**：設定允許打卡的區域範圍
- **位置歷史**：記錄常用打卡地點供快速選擇
- **離線地圖**：支援離線狀態下的基本定位
- **精度顯示**：顯示當前定位的精確度信息