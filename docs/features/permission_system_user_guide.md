# 工地紀錄照片系統權限管理 - 使用指南

## 🎯 功能概述

工地紀錄照片系統現在支援完整的權限管理功能，包括：

- **三級權限制度** (一般用戶/進階用戶/管理員)
- **設計圖擁有者管理** (添加/移除/修改用戶權限)
- **權限轉移功能** (轉移設計圖管理權)
- **精細化權限控制** (座標點/設計圖操作權限)

## 🔑 權限等級說明

### 👤 第一級 - 一般用戶

**可以做什麼：**

- ✅ 上傳照片記錄到設計圖上
- ✅ 刪除自己上傳的照片記錄和座標點

**不能做什麼：**

- ❌ 刪除其他人的照片記錄
- ❌ 刪除設計圖

### ⭐ 第二級 - 進階用戶

**可以做什麼：**

- ✅ 所有第一級權限
- ✅ 刪除其他人上傳的照片記錄和座標點

**不能做什麼：**

- ❌ 刪除設計圖

### 👑 第三級 - 管理員

**可以做什麼：**

- ✅ 所有第二級權限
- ✅ 刪除整個設計圖（包含所有相關照片記錄）

## 🏗️ 擁有者特權

設計圖的擁有者（上傳者）擁有最高權限：

- 🔧 **權限管理**：添加、修改、移除其他用戶的權限
- 👥 **用戶邀請**：通過郵箱邀請新用戶加入
- 🔄 **權限轉移**：將設計圖的管理權轉移給其他用戶
- 📊 **權限查看**：查看所有有權限用戶的列表

## 📱 使用流程

### 1. 上傳新設計圖

1. 在設計圖選擇頁面點擊 "+" 按鈕
2. 選擇並上傳設計圖檔案
3. 輸入設計圖名稱
4. 系統自動為您創建擁有者權限

### 2. 管理設計圖權限

1. 在設計圖選擇頁面，點擊設計圖右上角的 "⋮" 按鈕
2. 選擇 "權限管理"
3. 查看當前有權限的用戶列表

### 3. 添加新用戶權限

1. 在權限管理頁面點擊 "+" 按鈕
2. 輸入目標用戶的電子郵箱
3. 選擇權限等級（一般用戶/進階用戶/管理員）
4. 點擊 "添加"

### 4. 修改用戶權限

1. 在權限管理頁面找到目標用戶
2. 點擊用戶卡片右側的 "⋮" 按鈕
3. 選擇新的權限等級

### 5. 轉移管理權

1. 在權限管理頁面找到目標用戶
2. 點擊用戶卡片右側的 "⋮" 按鈕
3. 選擇 "🔄 轉移管理權"
4. 確認轉移（注意：您將失去此設計圖的管理權）

### 6. 移除用戶權限

1. 在權限管理頁面找到目標用戶
2. 點擊用戶卡片右側的 "⋮" 按鈕
3. 選擇 "🗑️ 移除權限"
4. 確認移除

## 🔒 安全性特性

### 權限檢查

- 每次操作前都會檢查用戶權限
- 防止越權操作和惡意刪除
- 確保數據安全

### 數據隔離

- 用戶只能看到有權限的設計圖
- 照片記錄按設計圖和權限隔離
- 防止未授權訪問

### 審計記錄

- 所有權限變更都有時間戳
- 追蹤誰在何時做了什麼操作
- 便於問題追查

## 🎨 UI 界面說明

### 設計圖選擇器

- **新界面**：設計圖卡片右上角新增選項按鈕
- **快速操作**：長按仍然可以快速刪除（需要權限）
- **權限入口**：點擊選項按鈕 → 權限管理

### 權限管理頁面

- **用戶列表**：顯示所有有權限用戶及其等級
- **權限圖標**：👤一般用戶 ⭐進階用戶 👑管理員
- **擁有者標識**：金色王冠圖標特別標識
- **操作菜單**：點擊用戶卡片右側按鈕顯示操作選項

### 添加權限對話框

- **郵箱輸入**：輸入目標用戶電子郵箱
- **權限選擇**：下拉選單選擇權限等級
- **權限說明**：即時顯示選中權限的詳細說明

## ⚠️ 注意事項

### 權限轉移

- 轉移擁有者權限後，您將失去此設計圖的管理權
- 建議先確認目標用戶是否可信
- 轉移無法撤銷，請謹慎操作

### 用戶邀請

- 目標用戶必須已經在系統中註冊
- 郵箱地址必須準確
- 重複添加會顯示錯誤

### 刪除操作

- 刪除設計圖會同時刪除所有相關照片記錄
- 被刪除的照片記錄無法恢復
- 建議在刪除前備份重要數據

## 🚀 最佳實踐

### 權限分配建議

- **工地管理員**：設為擁有者或第三級管理員
- **施工負責人**：設為第二級進階用戶
- **一般工人**：設為第一級一般用戶

### 安全管理

- 定期檢查用戶權限列表
- 及時移除離職人員的權限
- 謹慎使用權限轉移功能

### 數據管理

- 定期清理不需要的照片記錄
- 合理組織設計圖結構
- 做好重要數據的備份

## 🔧 技術實現

此權限管理系統基於以下技術實現：

- **後端**：Supabase 數據庫 + 行級安全性 (RLS)
- **前端**：Flutter + 響應式 UI 設計
- **權限模型**：基於角色的訪問控制 (RBAC)
- **安全性**：JWT 認證 + 權限中間件

## 📞 技術支援

如果您在使用過程中遇到問題，請聯繫開發團隊或查看系統日誌。
